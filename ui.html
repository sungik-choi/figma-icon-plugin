<h2>Bezier Figma Plugin</h2>
<button id="extract">Extract Icon</button>
<button id="cancel">Cancel</button>
<script type="module">
import { Octokit, App } from "https://cdn.skypack.dev/octokit";

document.getElementById('extract').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'extract' } }, '*')
}

document.getElementById('cancel').onclick = () => {
  parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*')
}

onmessage = async ({ data: { pluginMessage: { type, payload } }}) => {
  if (type === 'fetchSvg') {
    const response = await fetch(payload.url, {
      headers: {
        'Content-Type': 'application/json',
        'X-Figma-Token': payload.token
      }
    })

    const { images } = await response.json()

    const svgs = await Promise.all(
      payload.nodes.map(({ id, name }) => fetch(images[id])
        .then(response => response.text())
        .then(svg => ({ name, svg })))
    )

    console.log(svgs)
  }
}

</script>
